# [模組名稱] 功能規格書

> **文件版號**：V1.0  
> **產出日期**：{YYYY-MM-DD}  
> **負責人**：{Author}

---

## 1. 模組概述 (Overview)

| 項目 | 說明 |
|------|------|
| **模組目的** | (用一句話說明這個模組是用來解決什麼問題的) |
| **目標使用者** | (例如：一般專案成員、PM、系統管理員) |
| **核心價值** | (使用此模組能帶來什麼效益？) |

---

## 2. 功能清單 (Feature List)

> 以 User Story 格式撰寫：「作為 [角色]，我希望能 [功能]，以便 [目的]。」

| ID | 功能名稱 | User Story |
|----|----------|------------|
| F-001 | 查詢 | 作為管理員，我希望能查詢所有案件，以便掌握案件進度。 |
| F-002 | 新增 | 作為管理員，我希望能新增案件，以便建立新的徵集紀錄。 |
| F-003 | 編輯 | 作為管理員，我希望能編輯案件資料，以便修正錯誤或更新狀態。 |

---

## 3. 重要規則與限制 (Core Business Rules) 🔥

> ⚠️ **開發時需優先檢查此處，所有規則皆為「不可違反」的硬性規定。**

### 3.1 資料驗證 (Data Validation)

| 規則 ID | 類別 | 規則描述 | 錯誤訊息 |
|---------|------|----------|----------|
| V-001 | 必填檢查 | 案件名稱為必填欄位 | 「請輸入案件名稱」 |
| V-002 | 格式檢查 | Email 須符合標準格式 | 「Email 格式不正確」 |
| V-003 | 範圍限制 | 數量需介於 1-9999 | 「數量需介於 1 至 9999」 |
| V-004 | 唯一性 | 案件編號不可重複 | 「此編號已存在」 |
| V-005 | 關聯驗證 | 結束日期需晚於開始日期 | 「結束日期需晚於開始日期」 |

### 3.2 操作限制 (Operation Constraints)

| 規則 ID | 類別 | 規則描述 |
|---------|------|----------|
| O-001 | 狀態互斥 | 狀態為「已結案」時，禁止修改任何欄位 |
| O-002 | 前置條件 | 需先選擇分類才能新增項目 |
| O-003 | 刪除保護 | 有關聯之附件時，禁止刪除案件 |
| O-004 | 數量限制 | 單一案件最多上傳 20 個附件 |

### 3.3 顯示規則 (Display Rules)

| 規則 ID | 規則描述 |
|---------|----------|
| D-001 | 金額欄位顯示千分位逗號，小數點後兩位 |
| D-002 | 異常狀態 (逾期、駁回) 顯示紅色文字 |
| D-003 | 預設排序：依建立時間由新到舊 |

### 3.4 權限控制 (Permission / Access Control)

| 規則 ID | 角色 | 權限描述 |
|---------|------|----------|
| P-001 | 管理員 | 可執行所有操作 (CRUD) |
| P-002 | 一般成員 | 僅可查看與新增，不可刪除 |
| P-003 | 訪客 | 禁止存取此模組 |

---

## 4. 介面互動與流程 (UI Interaction Flow)

### 4.1 [畫面名稱：案件列表]

- **畫面構成**：
  - 頂部搜尋/篩選列
  - 資料表格 (套用 D-003 排序規則)
  - 分頁控制區
  
- **使用者操作**：
  1. 點擊「新增案件」按鈕
  2. 系統導向新增表單頁面

- **系統回饋**：
  - 若無資料 → 顯示空狀態提示「目前沒有案件」
  - 若有資料 → 以表格呈現

### 4.2 [畫面名稱：案件新增表單]

- **畫面構成**：
  - 表單區域：案件名稱、分類、說明等欄位
  - 底部操作按鈕：儲存、取消

- **使用者操作**：
  1. 填寫表單欄位
  2. 點擊「儲存」

- **系統回饋**：
  - 若通過 [3.1] 驗證 → 儲存成功，導回列表頁，顯示成功訊息
  - 若違反驗證規則 → 欄位下方顯示紅色錯誤訊息

---

## 5. 資料欄位定義 (Data Dictionary - Business View)

> ⚠️ 以業務觀點撰寫，勿寫 Database Type。

| 欄位名稱 | 欄位含義 | 資料格式範例 | 必填 | 備註/限制 |
|----------|----------|--------------|------|-----------|
| 案件編號 | 系統自動產生的唯一識別碼 | ACQ-2026-001 | 是 (自動) | 格式：ACQ-{年份}-{流水號} |
| 案件名稱 | 使用者定義的案件標題 | 謝里法捐贈案 | 是 | 最大 200 字 |
| 分類 | 徵集類型 | 捐贈 | 是 | 選項：捐贈/移撥/價購/徵集 |
| 狀態 | 案件處理狀態 | 評估中 | 是 (自動) | 選項：草稿/評估中/審議中/已核定/已撤案/已結案 |
| 建立時間 | 案件建立的時間戳記 | 2026-01-09 10:30 | 是 (自動) | 系統自動記錄 |

---

## 6. 資料流向 (Data Flow)

```
[使用者輸入]
      ↓
[前端驗證] ← 套用 Section 3.1 規則
      ↓
[API 請求] → POST /api/acquisition/cases
      ↓
[後端驗證] ← 再次驗證 + 權限檢查 (Section 3.4)
      ↓
[資料庫寫入] → digi.acquisition_cases
      ↓
[回傳結果] → 成功/失敗訊息
```

---

## 7. 測試案例 (Test Cases)

> ⚠️ **此區塊為自動化測試的依據**，AI 將依據此處產生 Playwright 測試程式。

### TC-001: 成功新增案件 ✅

- **測試類型**: 正向測試 (Happy Path)
- **前置條件**: 使用者已登入且角色為管理員
- **操作步驟**:
  1. 導航至案件列表頁 `/admin/acquisition/list`
  2. 點擊「新增案件」按鈕
  3. 輸入案件名稱：「自動化測試案件」
  4. 選擇分類：「捐贈」
  5. 點擊「儲存」按鈕
- **預期結果**: 
  - 頁面顯示成功訊息「案件新增成功」
  - 自動導回列表頁
  - 列表中出現剛新增的案件
- **對應規則**: [V-001], [O-002]

---

### TC-002: 案件名稱為空時顯示錯誤 ❌

- **測試類型**: 負向測試 (Validation Error)
- **前置條件**: 同 TC-001
- **操作步驟**:
  1. 導航至新增案件頁面
  2. **不輸入**案件名稱
  3. 點擊「儲存」按鈕
- **預期結果**: 
  - 案件名稱欄位下方顯示紅色錯誤訊息「請輸入案件名稱」
  - 頁面不跳轉
- **對應規則**: [V-001]

---

### TC-003: 未登入時禁止存取 🔒

- **測試類型**: 權限測試
- **前置條件**: 使用者**未登入**
- **操作步驟**:
  1. 直接訪問 `/admin/acquisition/create`
- **預期結果**: 
  - 系統自動導向登入頁面
- **對應規則**: [P-003]

---

## 8. 變更記錄 (Change Log)

| 版本 | 日期 | 修改者 | 修改說明 |
|------|------|--------|----------|
| V1.0 | {YYYY-MM-DD} | {Author} | 初版建立 |

