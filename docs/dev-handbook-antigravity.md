# Antigravity å°ˆæ¡ˆé–‹ç™¼ Handbook

> **ç‰ˆæœ¬**ï¼šv1.0 | **æœ€å¾Œæ›´æ–°**ï¼š2026-01-09  
> **ç‹€æ…‹**ï¼šPRIME DIRECTIVE â€” æœ¬æ–‡ä»¶ç‚ºæœ€é«˜å„ªå…ˆç´šé–‹ç™¼è¦ç¯„

---

## ğŸš¨ PRIME DIRECTIVE

æœ¬å°ˆæ¡ˆé–‹ç™¼å¿…é ˆ**åš´æ ¼éµå®ˆ**ä»¥ä¸‹è¦ç¯„ï¼Œç„¡ä»»ä½•ä¾‹å¤–ã€‚

---

## 1. é–‹ç™¼å‰å¿…è®€æ–‡ä»¶ï¼ˆä¾åºï¼‰

æ¯æ¬¡é–‹ç™¼å‰ï¼Œ**å¿…é ˆä¾åºé–±è®€**ä»¥ä¸‹æ–‡ä»¶ï¼š

| é †åº | æ–‡ä»¶ | ç”¨é€” |
|------|------|------|
| 1ï¸âƒ£ | `guidelines/Product_Context.md` | ç³»çµ±èƒŒæ™¯èˆ‡æ ¸å¿ƒè³‡æ–™æµ |
| 2ï¸âƒ£ | `docs/spac/rules.md` | å…¨åŸŸæ¥­å‹™è¦å‰‡èˆ‡åš´æ ¼ç¦åˆ¶äº‹é … |
| 3ï¸âƒ£ | `docs/plan/[æ¨¡çµ„åç¨±].md` | æœ¬æ¬¡ä»»å‹™éœ€æ±‚ |

---

## 2. æ–‡ä»¶å±¤ç´šå„ªå…ˆé †åº

ç”±é«˜åˆ°ä½ï¼š

```
1. guidelines/Product_Context.md    â† æœ€é«˜å„ªå…ˆç´š
2. docs/spac/rules.md
3. docs/plan/[æ¨¡çµ„åç¨±].md
4. ç¨‹å¼ç¢¼å¯¦ä½œ                        â† æœ€ä½å„ªå…ˆç´š
```

> âš ï¸ ç•¶è¦å‰‡è¡çªæ™‚ï¼Œä¸Šå±¤æ–‡ä»¶å„ªå…ˆæ–¼ä¸‹å±¤ã€‚

---

## 3. åš´æ ¼ç¦åˆ¶äº‹é … âŒ

ä»¥ä¸‹äº‹é …**çµ•å°ç¦æ­¢**ï¼Œé•åå°‡å°è‡´ PR è¢«æ‹’çµ•ï¼š

| # | ç¦æ­¢äº‹é … | åŸå›  |
|---|---------|------|
| 1 | `import.meta.env` | é€£ç·šè³‡è¨Šé ˆç”±è¨­å®š UI æˆ– localStorage æä¾› |
| 2 | `kv_store` é¡è¡¨æ ¼ | æ‰€æœ‰è³‡æ–™å¿…é ˆå­˜åœ¨çµæ§‹åŒ–è¡¨ä¸­ |
| 3 | ä¸€èˆ¬ CRUD æ”¾ Edge Functions | åƒ… AI æ¨è«–å¯ç”¨ Edge Functions |
| 4 | å¯«æ­»å‡è³‡æ–™ | Component å…§ä¸å¾— `const data = [...]` |
| 5 | `.single()` æŸ¥è©¢ | ä¸€å¾‹ä½¿ç”¨ `.maybeSingle()` |
| 6 | å¯«æ­» Schema åç¨± | å¿…é ˆä½¿ç”¨è®Šæ•¸å‚³é |
| 7 | `shadcn/ui` å…ƒä»¶ | é™¤éæ˜ç¢ºè¦æ±‚ï¼Œå¦å‰‡ç¦ç”¨ |
| 8 | Tailwind ä»»æ„å€¼ | å¿…é ˆä½¿ç”¨ Design Tokens / CSS è®Šæ•¸ |

---

## 4. æŠ€è¡“å †ç–Š

| å±¤ç´š | æŠ€è¡“ | èªªæ˜ |
|------|------|------|
| èªè¨€ | TypeScript | å…¨é¢ä½¿ç”¨ï¼Œstrict mode |
| å‰ç«¯æ¡†æ¶ | React 18 + Vite | SPA æ¶æ§‹ |
| æ¨£å¼ç³»çµ± | Tailwind CSS 4.0 | Design Tokens å®šç¾©æ–¼ `/styles/globals.css` |
| è³‡æ–™åº« | Supabase (PostgreSQL + RLS) | Row Level Security å•Ÿç”¨ |
| å‘é‡æœå°‹ | Supabase Vector + Hybrid Search | RAG ä½¿ç”¨ |
| æ¸¬è©¦ | Vitest | å–®å…ƒæ¸¬è©¦ + æ•´åˆæ¸¬è©¦ |

---

## 5. è³‡æ–™å­˜å–æ¶æ§‹

### 5.1 åˆ†å±¤æ¶æ§‹

```
UI/é é¢
    â†“
Serviceï¼ˆæ¥­å‹™é‚è¼¯ï¼‰
    â†“
Repositoryï¼ˆè³‡æ–™å­˜å–ä»‹é¢ï¼‰
    â†“
SupabaseAdapterï¼ˆAdapter Patternï¼‰
    â†“
Supabase Clientï¼ˆSingletonï¼‰
```

### 5.2 Adapter Pattern è¦å‰‡

- æ‰€æœ‰è³‡æ–™å­˜å–**å¿…é ˆ**é€é Adapter/Repository
- **ç¦æ­¢**åœ¨ UI å…ƒä»¶ç›´æ¥å‘¼å« Supabase client
- Client **å¿…é ˆ**æ˜¯ Singletonï¼Œå…¨å°ˆæ¡ˆåªå…è¨±ä¸€å€‹å¯¦ä¾‹
- Repository **å¿…é ˆ**å›å‚³ `{ data, error }` æ ¼å¼

### 5.3 æª”æ¡ˆçµæ§‹ç¯„ä¾‹

```
src/
â”œâ”€â”€ adapters/
â”‚   â””â”€â”€ supabase/
â”‚       â”œâ”€â”€ client.ts           # Singleton client
â”‚       â””â”€â”€ SupabaseAdapter.ts  # Base adapter
â”œâ”€â”€ repositories/
â”‚   â”œâ”€â”€ ItemRepository.ts
â”‚   â”œâ”€â”€ AcquisitionRepository.ts
â”‚   â””â”€â”€ ...
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ ItemService.ts
â”‚   â””â”€â”€ ...
â””â”€â”€ pages/
    â””â”€â”€ ...
```

---

## 6. æ¨£å¼ç³»çµ±è¦ç¯„

### 6.1 Design Tokens

æ‰€æœ‰é¡è‰²ã€é–“è·ã€åœ“è§’ã€é™°å½±**å¿…é ˆ**ï¼š

1. å¾ Figma Variables åŒ¯å‡º
2. å®šç¾©æ–¼ `/styles/globals.css` ä½œç‚º CSS è®Šæ•¸
3. é€é Tailwind 4.0 å¼•ç”¨

### 6.2 ç¯„ä¾‹

```css
/* /styles/globals.css */
:root {
  --color-primary-500: #3b82f6;
  --color-surface-1: #ffffff;
  --spacing-4: 1rem;
  --radius-md: 0.5rem;
  --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
}
```

```tsx
// âœ… æ­£ç¢º
<div className="bg-[var(--color-primary-500)] p-[var(--spacing-4)]">

// âŒ éŒ¯èª¤ï¼ˆä»»æ„å€¼ï¼‰
<div className="bg-blue-500 p-4">
```

---

## 7. RAG å‘é‡ç´¢å¼•è¦ç¯„

### 7.1 è³‡æ–™åŒæ­¥è¦å‰‡

- æ¯å€‹æª”æ¡ˆå°æ‡‰ä¸€çµ„ chunk/embedding
- åˆªé™¤æª”æ¡ˆæ™‚**å¿…é ˆ**åŒæ­¥åˆªé™¤å‘é‡è¡¨è¨˜éŒ„
- æ›´æ–°æª”æ¡ˆæ™‚**å¿…é ˆ**åŒæ­¥æ›´æ–°å‘é‡è¡¨

### 7.2 Edge Functions ä½¿ç”¨ç¯„åœ

| ç”¨é€” | å…è¨± |
|------|------|
| AI æ¨è«–/Embedding ç”¢ç”Ÿ | âœ… |
| ä¸€èˆ¬ CRUD æ“ä½œ | âŒ |
| Hybrid Search æŸ¥è©¢ | âœ… |

---

## 8. æ¸¬è©¦è¦ç¯„

### 8.1 å¿…è¦æ¸¬è©¦

| å±¤ç´š | æ¸¬è©¦é¡å‹ | è¦æ±‚ |
|------|---------|------|
| Service | å–®å…ƒæ¸¬è©¦ | å¿…é ˆ |
| é—œéµ Repository | å–®å…ƒæ¸¬è©¦ | å¿…é ˆ |
| é—œéµæµç¨‹ | æ•´åˆæ¸¬è©¦ | å¿…é ˆ |

### 8.2 é—œéµæµç¨‹å®šç¾©

ä»¥ä¸‹æµç¨‹éœ€æœ‰æ•´åˆæ¸¬è©¦æˆ–æ˜ç¢ºçš„æ‰‹å‹•æ¸¬è©¦æ­¥é©Ÿï¼š

```
å¾µé›† â†’ å…¥åº« â†’ ä¿å­˜ä¿®è­· â†’ æ•¸ä½åŒ– â†’ ç·¨ç›® â†’ ä¸Šæ¶ â†’ æå€Ÿ
```

---

## 9. é–‹ç™¼å·¥ä½œæµç¨‹

### 9.1 Plan-First æµç¨‹

1. é–±è®€å¿…è®€æ–‡ä»¶
2. ç”¢å‡º Implementation Plan
3. ç¢ºèªæ–‡ä»¶æ˜¯å¦å®Œæ•´æè¿°éœ€æ±‚
4. è‹¥æœ‰ç¼ºæ¼ï¼Œå…ˆæå•ä¸¦æ›´æ–° plan æ–‡ä»¶
5. ç¢ºèªå¾Œæ‰é–‹å§‹å¯¦ä½œ

### 9.2 Implement-Feature æµç¨‹

1. ä¾ Implementation Plan å¯¦ä½œ
2. å°ç…§ `rules.md` æª¢æŸ¥
3. å°ç…§ `plan/[æ¨¡çµ„åç¨±].md` æª¢æŸ¥
4. è‹¥æœ‰å·®ç•°ï¼Œå…ˆæ›´æ–°æ–‡ä»¶å†èª¿æ•´å¯¦ä½œ
5. æ’°å¯«æ¸¬è©¦
6. æäº¤ PR

---

## 10. PR/MR æª¢æŸ¥æ¸…å–®

### 10.1 ç¦åˆ¶äº‹é …æª¢æŸ¥

- [ ] ç„¡ `import.meta.env`
- [ ] ç„¡ `kv_store` é¡è¡¨æ ¼
- [ ] CRUD æœªæ”¾ Edge Functions
- [ ] ç„¡å¯«æ­»å‡è³‡æ–™
- [ ] æŸ¥è©¢ä½¿ç”¨ `.maybeSingle()` è€Œé `.single()`
- [ ] Schema åç¨±ä½¿ç”¨è®Šæ•¸
- [ ] ç„¡ `shadcn/ui` å…ƒä»¶

### 10.2 æ¶æ§‹æª¢æŸ¥

- [ ] è³‡æ–™å­˜å–é€é Repository/Adapter
- [ ] Supabase Client ä½¿ç”¨ Singleton
- [ ] Repository å›å‚³ `{ data, error }`

### 10.3 æ¨£å¼æª¢æŸ¥

- [ ] ä½¿ç”¨ Design Tokens / CSS è®Šæ•¸
- [ ] ç„¡ Tailwind ä»»æ„å€¼

### 10.4 æ–‡ä»¶ä¸€è‡´æ€§

- [ ] ç¨‹å¼ç¢¼ç¬¦åˆ `rules.md`
- [ ] ç¨‹å¼ç¢¼ç¬¦åˆ `plan/[æ¨¡çµ„åç¨±].md`
- [ ] è‹¥æœ‰å·®ç•°ï¼Œæ–‡ä»¶å·²æ›´æ–°

---

## 11. åƒè€ƒæ–‡ä»¶

| æ–‡ä»¶ | ä½ç½® |
|------|------|
| ç³»çµ±èƒŒæ™¯ | `guidelines/Product_Context.md` |
| å…¨åŸŸè¦å‰‡ | `docs/spac/rules.md` |
| æ¨¡çµ„è¨ˆç•« | `docs/plan/[æ¨¡çµ„åç¨±].md` |
| æ¶æ§‹æ¦‚è¦½ | `docs/010-architecture-overview.md` |
| è³‡æ–™æ¨¡å‹ | `docs/020-data-model.md` |
| é ˜åŸŸæµç¨‹ | `docs/030-domain-flows.md` |
| å°ˆæ¡ˆè¦å‰‡ | `docs/PROJECT_RULES.md` |

---

> **é•è¦è™•ç†**ï¼šä¸ç¬¦åˆ PRIME DIRECTIVE çš„ç¨‹å¼ç¢¼å°‡**ç«‹å³è¢«æ‹’çµ•**ï¼Œç„¡ä»»ä½•ä¾‹å¤–ã€‚
